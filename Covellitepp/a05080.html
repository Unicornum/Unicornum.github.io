<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WVJKS623L0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-WVJKS623L0');
    </script>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="generator" content="Doxygen 1.12.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Covellite++: Шейдеры</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Title.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Covellite++
   &#160;<span id="projectnumber">Version: 2.3.1 Revision: ??? Platform: x64 Build: 21:47 08.04.2025</span>
   </div>
   <div id="projectbrief">Кроссплатформенный фреймворк для разработки приложений на С++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Поиск',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('a05080.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Загрузка...</div>
<div class="SRStatus" id="Searching">Поиск...</div>
<div class="SRStatus" id="NoMatches">Не найдено</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Шейдеры</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Прежде чем тело шейдера (переданное в качестве параметров <b>data</b> и <b>count</b>) будет передано компилятору, ему будет добавлен заголовок и футер.</p>
<h2>Заголовок </h2>
<h3>Версия шейдера</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#version 330 core </span><span class="comment">// Только для OpenGL</span></div>
<div class="line"><span class="preprocessor">#version 300 es </span><span class="comment">// Только для OpenGLES3</span></div>
</div><!-- fragment --><h3>Предопределенные макросы типа шейдера</h3>
<ul>
<li><b>COVELLITE_SHADER_DESKTOP</b> или <b>COVELLITE_SHADER_MOBILE</b> </li>
<li><b>COVELLITE_SHADER_HLSL</b> или <b>COVELLITE_SHADER_GLSL</b> </li>
<li><b>COVELLITE_SHADER_VERTEX</b> или <b>COVELLITE_SHADER_PIXEL</b> </li>
</ul>
<h3>Файл вспомогательных определений для создания унифицированных шейдеров</h3>
<div class="fragment"><div class="line"> </div>
<div class="line">#ifdef COVELLITE_SHADER_HLSL // ********************************************* //</div>
<div class="line">  </div>
<div class="line">#define mediump</div>
<div class="line">#define lowp</div>
<div class="line">  </div>
<div class="line">#define ivec4 int4</div>
<div class="line">#define vec4 float4   </div>
<div class="line">#define vec3 float3   </div>
<div class="line">#define vec2 float2   </div>
<div class="line">#define mat4 float4x4 </div>
<div class="line">#define mat3 float3x3</div>
<div class="line">#define ToMatrix3x3(m) (float3x3)m</div>
<div class="line">  </div>
<div class="line">#define dFdx(a) ddx(a)</div>
<div class="line">#define dFdy(a) ddy(a)</div>
<div class="line">#define mix(a, b, c) lerp(a, b, c)</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_INPUT_SEMANTIC(value) \</div>
<div class="line">  : value</div>
<div class="line">#define COVELLITE_DECLARE_CONST_BUFFER(type, cbname, name, index) \</div>
<div class="line">  cbuffer cb##name : register(b##index) { const type name; }</div>
<div class="line">#define COVELLITE_DECLARE_CONST_BUFFER_INSIDE(type, name, index) \</div>
<div class="line">  COVELLITE_DECLARE_CONST_BUFFER(type, dummy, name, index)</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_DECLARE_STATIC \</div>
<div class="line">  static</div>
<div class="line">#define COVELLITE_MATRIX_ROW(m, index) \</div>
<div class="line">  m[index]</div>
<div class="line">#define COVELLITE_MATRIX_COLUMN(m, index) \</div>
<div class="line">  float4(m[0][index], m[1][index], m[2][index], m[3][index])</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_DECLARE_TEX2D(name, index) \</div>
<div class="line">  Texture2D name : register(t##index); \</div>
<div class="line">  SamplerState TexSampler##index : register(s##index);</div>
<div class="line">#define COVELLITE_DECLARE_TEX2D_ARRAY(name, count, index) \</div>
<div class="line">  Texture2D name[count] : register(t##index); \</div>
<div class="line">  SamplerState TexSampler##index : register(s##index);</div>
<div class="line">#define COVELLITE_TEX2D_COLOR(tex, uv) \</div>
<div class="line">  tex.Sample(TexSampler0, uv)</div>
<div class="line">#define COVELLITE_TEX2D_ARRAY_COLOR(tex, i, uv) \</div>
<div class="line">  tex[i].Sample(TexSampler0, uv)</div>
<div class="line">#define COVELLITE_DECLARE_MULTI_TARGET_STRUCTURE(name, count) \</div>
<div class="line">  struct name { float4 Target[count] : SV_Target; }</div>
<div class="line">  </div>
<div class="line">#elif defined COVELLITE_SHADER_GLSL // ************************************** //</div>
<div class="line">  </div>
<div class="line">precision highp float;</div>
<div class="line">precision highp int;</div>
<div class="line">  </div>
<div class="line">#define int4 ivec4</div>
<div class="line">#define float4 vec4</div>
<div class="line">#define float3 vec3</div>
<div class="line">#define float2 vec2</div>
<div class="line">#define float4x4 mat4</div>
<div class="line">#define float3x3 mat3</div>
<div class="line">#define ToMatrix3x3(m) mat3(m)</div>
<div class="line">  </div>
<div class="line">#define ddx(a) dFdx(a)</div>
<div class="line">#define ddy(a) dFdy(a)</div>
<div class="line">#define mul(a, b) ((a) * (b))</div>
<div class="line">#define saturate(a) clamp(a, 0.0f, 1.0f)</div>
<div class="line">#define rsqrt(a) (1.0f / sqrt(a))</div>
<div class="line">#define lerp(a, b, c) mix(a, b, c)</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_INPUT_SEMANTIC(value)</div>
<div class="line">#define COVELLITE_DECLARE_CONST_BUFFER(type, cbname, name, index) \</div>
<div class="line">  layout (std140) uniform cbname { type name; }</div>
<div class="line">#define COVELLITE_DECLARE_CONST_BUFFER_INSIDE(type, name, index) \</div>
<div class="line">  uniform type name</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_DECLARE_STATIC</div>
<div class="line">#define COVELLITE_MATRIX_ROW(m, index) \</div>
<div class="line">  float4(m[0][index], m[1][index], m[2][index], m[3][index])</div>
<div class="line">#define COVELLITE_MATRIX_COLUMN(m, index) \</div>
<div class="line">  m[index]</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_DECLARE_TEX2D(name, index) \</div>
<div class="line">  uniform sampler2D name</div>
<div class="line">#define COVELLITE_DECLARE_TEX2D_ARRAY(name, count, index) \</div>
<div class="line">  uniform highp sampler2DArray name</div>
<div class="line">#define COVELLITE_TEX2D_COLOR(tex, uv) \</div>
<div class="line">  texture(tex, uv)</div>
<div class="line">#define COVELLITE_TEX2D_ARRAY_COLOR(tex, i, uv) \</div>
<div class="line">  texture(tex, vec3(uv, i))</div>
<div class="line">#define COVELLITE_DECLARE_MULTI_TARGET_STRUCTURE(name, count) \</div>
<div class="line">  struct name { float4 Target[count]; }; \</div>
<div class="line">  out float4 Covellite_MultiOutPixelColor[count]</div>
<div class="line">  </div>
<div class="line">#endif // ******************************************************************* //</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_DECLARE_CONST_USER_BUFFER(type, cbname, name) \</div>
<div class="line">  COVELLITE_DECLARE_CONST_BUFFER(type, cbname, name, COVELLITE_BUFFER_INDEX_USER)</div>
<div class="line">  </div>
<div class="line">#define ToFloat3(v) v.xyz</div>
</div><!-- fragment --><h3>Файл объвления структур для передачи данных шейдеру</h3>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef COVELLITE_API_CONSTANT_BUFFERS_HEADER</span></div>
<div class="line"><span class="preprocessor">#define COVELLITE_API_CONSTANT_BUFFERS_HEADER</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef GLM_VERSION</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>float4x4 = ::glm::mat4;</div>
<div class="line"><span class="preprocessor">#define mediump</span></div>
<div class="line"><span class="preprocessor">#define lowp</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// GLM_VERSION</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_CAMERA 0</span></div>
<div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_OBJECT 1</span></div>
<div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_USER 2</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Camera</div>
<div class="line">{</div>
<div class="line">  float4x4 Projection;</div>
<div class="line">  float4x4 View;</div>
<div class="line">  float4x4 ViewInverse;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Object</div>
<div class="line">{</div>
<div class="line">  float4x4 World;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// COVELLITE_API_CONSTANT_BUFFERS_HEADER</span></div>
</div><!-- fragment --><h3>Файл объявления форматов входных данных шейдеров</h3>
<div class="fragment"><div class="line">  </div>
<div class="line">#define COVELLITE_INSTANCE_DATA_STRUCTURE \</div>
<div class="line">  /* place for instance variables */</div>
<div class="line"> </div>
<div class="line">#ifdef COVELLITE_SHADER_GLSL // ********************************************* //</div>
<div class="line">  </div>
<div class="line">#ifdef COVELLITE_SHADER_VERTEX /////////////////////////////////////////////////</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_IN in</div>
<div class="line">  </div>
<div class="line">// Covellite++ GLSL input data vertex shader.</div>
<div class="line">in vec4 Covellite_VertexPosition;</div>
<div class="line">in mediump vec2 Covellite_VertexTexCoord;</div>
<div class="line">in vec4 Covellite_VertexExtra;</div>
<div class="line">COVELLITE_INSTANCE_DATA_STRUCTURE</div>
<div class="line">  </div>
<div class="line">#undef COVELLITE_IN</div>
<div class="line">  </div>
<div class="line">#endif /////////////////////////////////////////////////////////////////////////</div>
<div class="line">  </div>
<div class="line">#endif // ******************************************************************* //</div>
<div class="line">  </div>
<div class="line">#define COVELLITE_IN</div>
<div class="line">  </div>
<div class="line">COVELLITE_DECLARE_CONST_BUFFER_INSIDE(Camera, CameraData, COVELLITE_BUFFER_INDEX_CAMERA);</div>
<div class="line">COVELLITE_DECLARE_CONST_BUFFER_INSIDE(Object, ObjectData, COVELLITE_BUFFER_INDEX_OBJECT);</div>
<div class="line">  </div>
<div class="line">// Input data vertex shader (union objects).</div>
<div class="line">struct Vertex</div>
<div class="line">{</div>
<div class="line">  float4 Position           COVELLITE_INPUT_SEMANTIC(POSITION);</div>
<div class="line">  mediump float2 TexCoord   COVELLITE_INPUT_SEMANTIC(TEXCOORD);</div>
<div class="line">  float4 Extra              COVELLITE_INPUT_SEMANTIC(NORMAL);</div>
<div class="line">  COVELLITE_INSTANCE_DATA_STRUCTURE</div>
<div class="line">};</div>
<div class="line">  </div>
<div class="line">// Output data vertex shader and input data pixel shader.</div>
<div class="line">struct Pixel</div>
<div class="line">{</div>
<div class="line">  float4 ScreenPos        COVELLITE_INPUT_SEMANTIC(SV_POSITION);</div>
<div class="line">  lowp float4 Color       COVELLITE_INPUT_SEMANTIC(COLOR);</div>
<div class="line">  float3 Normal           COVELLITE_INPUT_SEMANTIC(NORMAL);</div>
<div class="line">  mediump float2 TexCoord COVELLITE_INPUT_SEMANTIC(TEXCOORD0);</div>
<div class="line">  float4 WorldPos         COVELLITE_INPUT_SEMANTIC(POSITION0);</div>
<div class="line">};</div>
</div><!-- fragment --><dl class="section note"><dt>Заметки</dt><dd>В случае ошибки компиляции шейдера описание исключения будет содержать количество строк, добавленных фреймворком к переданному телу шейдера.</dd></dl>
<h2>Тело шейдера </h2>
<p>Тело шейдера должно содержать определение функции, имя которой передается компоненту шейдера как параметр <b>entry</b>. Имя этой функции может быть любым, но сигнатура ее должна соответствовать одной из следующего набора (тип входного параметра определяет тип шейдера и формат передаваемых ему данных):</p>
<div class="fragment"><div class="line">Pixel entry(Vertex _Value); <span class="comment">// Вертексный шейдер</span></div>
<div class="line">float4 entry(Pixel _Value); <span class="comment">// Пиксельный шейдер</span></div>
</div><!-- fragment --><dl class="section note"><dt>Заметки</dt><dd>Если необходимо использовать другую структуру для передачи информации о пикселе, нужно объявить эту структуру и переопределить Pixel через #define Pixel UserPixel (в этом случае следует убедиться, что вертексный и пиксельный шейдер используют для обмена данными одну и ту же структуру).</dd></dl>
<p>Если указаны бинарные данные шейдера (параметры <b>data</b> и <b>count</b>), в качестве тела шейдера будет использован переданный буфер, если нет, то вместо них будут использоваться шейдеры по умолчанию (те, что использует сам фреймворк для рендеринга Gui):</p>
<div class="fragment"><div class="line"> </div>
<div class="line">#ifdef COVELLITE_SHADER_VERTEX /////////////////////////////////////////////////</div>
<div class="line">  </div>
<div class="line">// ************************************************************************** //</div>
<div class="line">  </div>
<div class="line">Pixel vsFlat(Vertex _Value)</div>
<div class="line">{</div>
<div class="line">  float4x4 ViewProjection = mul(CameraData.View, CameraData.Projection);</div>
<div class="line">  float4 WorldPos = mul(_Value.Position, ObjectData.World);</div>
<div class="line"> </div>
<div class="line">  Pixel Result;</div>
<div class="line">  Result.ScreenPos = mul(WorldPos, ViewProjection);</div>
<div class="line">  Result.Color = _Value.Extra;</div>
<div class="line">  Result.Normal = float3(0.0f, 0.0f, 1.0f);</div>
<div class="line">  Result.TexCoord = _Value.TexCoord;</div>
<div class="line">  Result.WorldPos = float4(0.0f, 0.0f, 0.0f, 1.0f);</div>
<div class="line">  return Result;</div>
<div class="line">}</div>
<div class="line">  </div>
<div class="line">Pixel vsVolume(Vertex _Value)</div>
<div class="line">{</div>
<div class="line">  float4x4 ViewProjection = mul(CameraData.View, CameraData.Projection);</div>
<div class="line">  float4 WorldPos = mul(_Value.Position, ObjectData.World);</div>
<div class="line"> </div>
<div class="line">  Pixel Result;</div>
<div class="line">  Result.ScreenPos = mul(WorldPos, ViewProjection);</div>
<div class="line">  Result.Color = float4(1.0f, 0.0f, 0.0f, 1.0f);</div>
<div class="line">  Result.Normal = normalize(mul(ToFloat3(_Value.Extra), ToMatrix3x3(ObjectData.World)));</div>
<div class="line">  Result.TexCoord = _Value.TexCoord;</div>
<div class="line">  Result.WorldPos = WorldPos;</div>
<div class="line">  return Result;</div>
<div class="line">}</div>
<div class="line">  </div>
<div class="line">#elif defined COVELLITE_SHADER_PIXEL ///////////////////////////////////////////</div>
<div class="line">  </div>
<div class="line">COVELLITE_DECLARE_TEX2D(TexDiffuse, 0);</div>
<div class="line">  </div>
<div class="line">float4 psColored(Pixel _Value)</div>
<div class="line">{</div>
<div class="line">  return _Value.Color;</div>
<div class="line">}</div>
<div class="line">  </div>
<div class="line">float4 psTextured(Pixel _Value)</div>
<div class="line">{</div>
<div class="line">  return COVELLITE_TEX2D_COLOR(TexDiffuse, _Value.TexCoord) * _Value.Color;</div>
<div class="line">}</div>
<div class="line">  </div>
<div class="line">#endif /////////////////////////////////////////////////////////////////////////</div>
</div><!-- fragment --><h2>Футер </h2>
<p>В конце тела шейдера добавляется определение функции, которая будет вызывать функцию, указанную в качестве параметра <b>entry</b> (это сделано для возможности создания единого унифицированного HLSL и GLSL тела шейдера).</p>
<h3>HLSL (вертексный шейдер)</h3>
<p>Ничего не добавляется, указанная функция вызывается напрямую.</p>
<h3>HLSL (пиксельный шейдер)</h3>
<div class="fragment"><div class="line">float4 psMain(Pixel _Value) : SV_Target</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> entry(_Value);</div>
<div class="line">}</div>
</div><!-- fragment --><h3>GLSL (вертексный шейдер)</h3>
<div class="fragment"><div class="line">out Pixel PixelValue;</div>
<div class="line"><span class="keywordtype">void</span> main()</div>
<div class="line">{</div>
<div class="line">  Vertex InputData;</div>
<div class="line">  InputData.Position = Covellite_VertexPosition;</div>
<div class="line">  InputData.TexCoord = Covellite_VertexTexCoord;</div>
<div class="line">  InputData.Extra = Covellite_VertexExtra;</div>
<div class="line">  PixelValue = entry(InputData);</div>
<div class="line">  gl_Position = PixelValue.ScreenPos;</div>
<div class="line">}</div>
</div><!-- fragment --><h3>GLSL (пиксельный шейдер)</h3>
<div class="fragment"><div class="line">in Pixel PixelValue;</div>
<div class="line">out vec4 Covellite_OutPixelColor;</div>
<div class="line"><span class="keywordtype">void</span> main()</div>
<div class="line">{</div>
<div class="line">  Covellite_OutPixelColor = entry(PixelValue);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Документация по Covellite++. Последние изменения: Вт 8 Апр 2025 21:48:12. Создано системой <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>

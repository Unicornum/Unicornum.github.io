<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Covellite++: Шейдеры</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Title.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Covellite++
   &#160;<span id="projectnumber">Version: 2.2.3 Revision: 2192 Platform: x64 Build: 16:21 28.10.2019</span>
   </div>
   <div id="projectbrief">Кроссплатформенный (Windows/Android) GUI фреймворк для разработки приложений на С++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Поиск');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Поиск');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a37012.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Шейдеры </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Прежде чем тело шейдера (переданное в качестве параметров <b>data</b> и <b>count</b>) будет передано компилятору, ему будет добавлен заголовок и футер.</p>
<h2>Заголовок </h2>
<h3>Версия шейдера</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#version 330 core // Только для OpenGL</span></div><div class="line"><span class="preprocessor">#version 300 es // Только для OpenGLES3</span></div></div><!-- fragment --><h3>Предопределенные макросы типа шейдера</h3>
<ul>
<li><b>COVELLITE_SHADER_DESKTOP</b> или <b>COVELLITE_SHADER_MOBILE</b> </li>
<li><b>COVELLITE_SHADER_HLSL</b> или <b>COVELLITE_SHADER_GLSL</b> </li>
<li><b>COVELLITE_SHADER_VERTEX</b> или <b>COVELLITE_SHADER_PIXEL</b> </li>
</ul>
<h3>Файл вспомогательных определений для создания унифицированных шейдеров</h3>
<div class="fragment"><div class="line"></div><div class="line">#ifdef COVELLITE_SHADER_HLSL // ********************************************* //</div><div class="line">  </div><div class="line">#define mediump</div><div class="line">#define lowp</div><div class="line">  </div><div class="line">#define ivec4 int4</div><div class="line">#define vec4 float4   </div><div class="line">#define vec3 float3   </div><div class="line">#define vec2 float2   </div><div class="line">#define mat4 float4x4 </div><div class="line">#define mat3 float3x3</div><div class="line">#define ToMatrix3x3(m) (float3x3)m</div><div class="line">  </div><div class="line">#define dFdx(a) ddx(a)</div><div class="line">#define dFdy(a) ddy(a)</div><div class="line">#define mix(a, b, c) lerp(a, b, c)</div><div class="line">  </div><div class="line">#define COVELLITE_INPUT_SEMANTIC(value) \</div><div class="line">  : value</div><div class="line">#define COVELLITE_DECLARE_CONST_BUFFER(type, cbname, name, index) \</div><div class="line">  cbuffer cb##name : register(b##index) { const type name; }</div><div class="line">#define COVELLITE_DECLARE_CONST_BUFFER_INSIDE(type, name, index) \</div><div class="line">  COVELLITE_DECLARE_CONST_BUFFER(type, dummy, name, index)</div><div class="line">  </div><div class="line">#define COVELLITE_DECLARE_STATIC \</div><div class="line">  static</div><div class="line">#define COVELLITE_MATRIX_ROW(m, index) \</div><div class="line">  m[index]</div><div class="line">#define COVELLITE_MATRIX_COLUMN(m, index) \</div><div class="line">  float4(m[0][index], m[1][index], m[2][index], m[3][index])</div><div class="line">  </div><div class="line">#define COVELLITE_DECLARE_TEX2D(name, index) \</div><div class="line">  Texture2D name : register(t##index); \</div><div class="line">  SamplerState TexSampler##index : register(s##index);</div><div class="line">#define COVELLITE_TEX2D_COLOR(tex, uv) \</div><div class="line">  tex.Sample(TexSampler0, uv)</div><div class="line">#define COVELLITE_DECLARE_MULTI_TARGET_STRUCTURE(name, count) \</div><div class="line">  struct name { float4 Target[count] : SV_Target; }</div><div class="line">  </div><div class="line">#elif defined COVELLITE_SHADER_GLSL // ************************************** //</div><div class="line">  </div><div class="line">precision highp float;</div><div class="line">precision highp int;</div><div class="line">  </div><div class="line">#define int4 ivec4</div><div class="line">#define float4 vec4</div><div class="line">#define float3 vec3</div><div class="line">#define float2 vec2</div><div class="line">#define float4x4 mat4</div><div class="line">#define float3x3 mat3</div><div class="line">#define ToMatrix3x3(m) mat3(m)</div><div class="line">  </div><div class="line">#define ddx(a) dFdx(a)</div><div class="line">#define ddy(a) dFdy(a)</div><div class="line">#define mul(a, b) ((a) * (b))</div><div class="line">#define saturate(a) clamp(a, 0.0f, 1.0f)</div><div class="line">#define rsqrt(a) (1.0f / sqrt(a))</div><div class="line">#define lerp(a, b, c) mix(a, b, c)</div><div class="line">  </div><div class="line">#define COVELLITE_INPUT_SEMANTIC(value)</div><div class="line">#define COVELLITE_DECLARE_CONST_BUFFER(type, cbname, name, index) \</div><div class="line">  layout (std140) uniform cbname { type name; }</div><div class="line">#define COVELLITE_DECLARE_CONST_BUFFER_INSIDE(type, name, index) \</div><div class="line">  uniform type name</div><div class="line">  </div><div class="line">#define COVELLITE_DECLARE_STATIC</div><div class="line">#define COVELLITE_MATRIX_ROW(m, index) \</div><div class="line">  float4(m[0][index], m[1][index], m[2][index], m[3][index])</div><div class="line">#define COVELLITE_MATRIX_COLUMN(m, index) \</div><div class="line">  m[index]</div><div class="line">  </div><div class="line">#define COVELLITE_DECLARE_TEX2D(name, index) \</div><div class="line">  uniform sampler2D name</div><div class="line">#define COVELLITE_TEX2D_COLOR(tex, uv) \</div><div class="line">  texture(tex, uv)</div><div class="line">#define COVELLITE_DECLARE_MULTI_TARGET_STRUCTURE(name, count) \</div><div class="line">  struct name { float4 Target[count]; }; \</div><div class="line">  out float4 Covellite_MultiOutPixelColor[count]</div><div class="line">  </div><div class="line">#endif // ******************************************************************* //</div><div class="line">  </div><div class="line">#define COVELLITE_DECLARE_CONST_USER_BUFFER(type, cbname, name) \</div><div class="line">  COVELLITE_DECLARE_CONST_BUFFER(type, cbname, name, COVELLITE_BUFFER_INDEX_USER)</div><div class="line">  </div><div class="line">#define ToFloat3(v) v.xyz</div></div><!-- fragment --><h3>Файл объвления структур для передачи данных шейдеру</h3>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#ifndef COVELLITE_API_CONSTANT_BUFFERS_HEADER</span></div><div class="line"><span class="preprocessor">#define COVELLITE_API_CONSTANT_BUFFERS_HEADER</span></div><div class="line">  </div><div class="line"><span class="preprocessor">#ifdef GLM_VERSION</span></div><div class="line">  </div><div class="line"><span class="keyword">using</span> float4 = ::glm::vec4;</div><div class="line"><span class="keyword">using</span> float4x4 = ::glm::mat4;</div><div class="line"><span class="preprocessor">#define mediump</span></div><div class="line"><span class="preprocessor">#define lowp</span></div><div class="line"> </div><div class="line"><span class="preprocessor">#endif // GLM_VERSION</span></div><div class="line">  </div><div class="line"><span class="preprocessor">#define color_t float4</span></div><div class="line">  </div><div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_CAMERA 0</span></div><div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_FOG 1</span></div><div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_OBJECT 2</span></div><div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_USER 3</span></div><div class="line">  </div><div class="line"><span class="preprocessor">#define COVELLITE_MAX_LIGHT_POINT_OBJECT_COUNT 4</span></div><div class="line">    </div><div class="line"><span class="keyword">struct </span>Camera</div><div class="line">{</div><div class="line">  float4x4 Projection;</div><div class="line">  float4x4 View;</div><div class="line">  float4x4 ViewInverse;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>Fog</div><div class="line">{</div><div class="line">  color_t Color;</div><div class="line">  <span class="keywordtype">float</span>   Near;</div><div class="line">  <span class="keywordtype">float</span>   Far;</div><div class="line">  <span class="keywordtype">float</span>   Density;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>Ambient_t</div><div class="line">{</div><div class="line">  color_t  Color;</div><div class="line">  <span class="keywordtype">int</span> IsValid, align1, align2, align3;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>Direction_t</div><div class="line">{</div><div class="line">  color_t  Color;</div><div class="line">  float4   Direction;</div><div class="line">  <span class="keywordtype">int</span> IsValid, align1, align2, align3;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>Point_t</div><div class="line">{</div><div class="line">  color_t Color;</div><div class="line">  float4  Position;</div><div class="line">  float4  Attenuation; <span class="comment">// Const, Linear, Exponent, Radius;</span></div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>Points_t</div><div class="line">{</div><div class="line">  Point_t Lights[COVELLITE_MAX_LIGHT_POINT_OBJECT_COUNT];</div><div class="line">  <span class="keywordtype">int</span>     UsedSlotCount;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>Lights_t</div><div class="line">{</div><div class="line">  Ambient_t   Ambient;</div><div class="line">  Direction_t Direction;</div><div class="line">  Points_t    Points;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>Object</div><div class="line">{</div><div class="line">  float4x4 World;</div><div class="line">  Lights_t Lights;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="comment">// **************************** deprecated ********************************** //</span></div><div class="line">  </div><div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_MATRICES 4</span></div><div class="line"><span class="preprocessor">#define COVELLITE_BUFFER_INDEX_LIGHTS 5</span></div><div class="line">  </div><div class="line"><span class="preprocessor">#define COVELLITE_MAX_LIGHT_POINT_SCENE_COUNT 16</span></div><div class="line">  </div><div class="line"><span class="keyword">struct </span>ScenePoints</div><div class="line">{</div><div class="line">  Point_t Lights[COVELLITE_MAX_LIGHT_POINT_SCENE_COUNT];</div><div class="line">  <span class="keywordtype">int</span>     UsedSlotCount;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>SceneLights</div><div class="line">{</div><div class="line">  Ambient_t   Ambient;</div><div class="line">  Direction_t Direction;</div><div class="line">  ScenePoints Points;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="keyword">struct </span>Matrices</div><div class="line">{</div><div class="line">  float4x4 World;</div><div class="line">  float4x4 Projection;</div><div class="line">  float4x4 View;</div><div class="line">  float4x4 ViewInverse;</div><div class="line">};</div><div class="line">  </div><div class="line"><span class="comment">// ************************************************************************** //</span></div><div class="line">  </div><div class="line"><span class="preprocessor">#endif // COVELLITE_API_CONSTANT_BUFFERS_HEADER</span></div></div><!-- fragment --><h3>Файл объявления форматов входных данных шейдеров</h3>
<div class="fragment"><div class="line">  </div><div class="line">#define COVELLITE_INSTANCE_DATA_STRUCTURE \</div><div class="line">  /* place for instance variables */</div><div class="line"></div><div class="line">#ifdef COVELLITE_SHADER_GLSL // ********************************************* //</div><div class="line">  </div><div class="line">#ifdef COVELLITE_SHADER_VERTEX /////////////////////////////////////////////////</div><div class="line">  </div><div class="line">#define COVELLITE_IN in</div><div class="line">  </div><div class="line">// Covellite++ GLSL input data vertex shader.</div><div class="line">in vec4 Covellite_VertexPosition;</div><div class="line">in mediump vec2 Covellite_VertexTexCoord;</div><div class="line">in vec4 Covellite_VertexExtra;</div><div class="line">COVELLITE_INSTANCE_DATA_STRUCTURE</div><div class="line">  </div><div class="line">#undef COVELLITE_IN</div><div class="line">  </div><div class="line">#endif /////////////////////////////////////////////////////////////////////////</div><div class="line">  </div><div class="line">#endif // ******************************************************************* //</div><div class="line">  </div><div class="line">#define COVELLITE_IN</div><div class="line">  </div><div class="line">COVELLITE_DECLARE_CONST_BUFFER_INSIDE(Camera, CameraData, COVELLITE_BUFFER_INDEX_CAMERA);</div><div class="line">COVELLITE_DECLARE_CONST_BUFFER_INSIDE(Fog,    FogData,    COVELLITE_BUFFER_INDEX_FOG);</div><div class="line">COVELLITE_DECLARE_CONST_BUFFER_INSIDE(Object, ObjectData, COVELLITE_BUFFER_INDEX_OBJECT);</div><div class="line">  </div><div class="line">// Input data vertex shader (union objects).</div><div class="line">struct Vertex</div><div class="line">{</div><div class="line">  float4 Position           COVELLITE_INPUT_SEMANTIC(POSITION);</div><div class="line">  mediump float2 TexCoord   COVELLITE_INPUT_SEMANTIC(TEXCOORD);</div><div class="line">  float4 Extra              COVELLITE_INPUT_SEMANTIC(NORMAL);</div><div class="line">  COVELLITE_INSTANCE_DATA_STRUCTURE</div><div class="line">};</div><div class="line">  </div><div class="line">// Output data vertex shader and input data pixel shader.</div><div class="line">struct Pixel</div><div class="line">{</div><div class="line">  float4 ScreenPos        COVELLITE_INPUT_SEMANTIC(SV_POSITION);</div><div class="line">  lowp float4 Color       COVELLITE_INPUT_SEMANTIC(COLOR);</div><div class="line">  float3 Normal           COVELLITE_INPUT_SEMANTIC(NORMAL);</div><div class="line">  mediump float2 TexCoord COVELLITE_INPUT_SEMANTIC(TEXCOORD0);</div><div class="line">  float4 WorldPos         COVELLITE_INPUT_SEMANTIC(POSITION0);</div><div class="line">};</div><div class="line">  </div><div class="line">// **************************** deprecated ********************************** //</div><div class="line">  </div><div class="line">COVELLITE_DECLARE_CONST_BUFFER_INSIDE(Matrices, MatricesData, COVELLITE_BUFFER_INDEX_MATRICES);</div><div class="line">COVELLITE_DECLARE_CONST_BUFFER_INSIDE(SceneLights, LightsData, COVELLITE_BUFFER_INDEX_LIGHTS);</div><div class="line">  </div><div class="line">// Input data vertex shader (flat objects).</div><div class="line">struct Polygon</div><div class="line">{</div><div class="line">  float2 Position  COVELLITE_INPUT_SEMANTIC(POSITION);</div><div class="line">  uint Color       COVELLITE_INPUT_SEMANTIC(COLOR);</div><div class="line">  float2 TexCoord  COVELLITE_INPUT_SEMANTIC(TEXCOORD);</div><div class="line">};</div><div class="line">  </div><div class="line">// Input data vertex shader (volume objects).</div><div class="line">struct Polyhedron</div><div class="line">{</div><div class="line">  float3 Position  COVELLITE_INPUT_SEMANTIC(POSITION);</div><div class="line">  float3 Normal    COVELLITE_INPUT_SEMANTIC(NORMAL);</div><div class="line">  float2 TexCoord  COVELLITE_INPUT_SEMANTIC(TEXCOORD);</div><div class="line">};</div><div class="line">  </div><div class="line">// ************************************************************************** //</div></div><!-- fragment --><dl class="section note"><dt>Заметки</dt><dd>В случае ошибки компиляции шейдера описание исключения будет содержать количество строк, добавленных фреймворком к переданному телу шейдера.</dd></dl>
<h2>Тело шейдера </h2>
<p>Тело шейдера должно содержать определение функции, имя которой передается компоненту шейдера как параметр <b>entry</b>. Имя этой функции может быть любым, но сигнатура ее должна соответствовать одной из следующего набора (тип входного параметра определяет тип шейдера и формат передаваемых ему данных):</p>
<div class="fragment"><div class="line">Pixel entry(Polygon _Value); <span class="comment">// Вертексный шейдер для рендеринга 2D объектов (deprecated)</span></div><div class="line">Pixel entry(Polyhedron _Value); <span class="comment">// Вертексный шейдер для рендеринга 3D объектов (deprecated)</span></div><div class="line">Pixel entry(Vertex _Value); <span class="comment">// Вертексный шейдер</span></div><div class="line">float4 entry(Pixel _Value); <span class="comment">// Пиксельный шейдер</span></div></div><!-- fragment --><p>Если указаны бинарные данные шейдера (параметры <b>data</b> и <b>count</b>), в качестве тела шейдера будет использован переданный буфер, если нет, то вместо них будут использоваться шейдеры по умолчанию (те, что использует сам фреймворк для рендеринга Gui):</p>
<div class="fragment"><div class="line"></div><div class="line">#ifdef COVELLITE_SHADER_VERTEX /////////////////////////////////////////////////</div><div class="line">  </div><div class="line">// ************************************************************************** //</div><div class="line">  </div><div class="line">float4 GetAmbientDirectionColor(float3 _Normal)</div><div class="line">{</div><div class="line">  // Source: https://habr.com/ru/post/338254/</div><div class="line">    </div><div class="line">  float4 Result = float4(0.0f, 0.0f, 0.0f, 0.0f);</div><div class="line">    </div><div class="line">  if (ObjectData.Lights.Ambient.IsValid == 1) // Ambient</div><div class="line">  {</div><div class="line">    Result += ObjectData.Lights.Ambient.Color;</div><div class="line">  }</div><div class="line">    </div><div class="line">  if (ObjectData.Lights.Direction.IsValid == 1) // Direction</div><div class="line">  {</div><div class="line">    float3 Direction = normalize(ToFloat3(ObjectData.Lights.Direction.Direction));</div><div class="line">    Result += max(dot(_Normal, Direction), 0.0f) * </div><div class="line">      ObjectData.Lights.Direction.Color;</div><div class="line">  }</div><div class="line">    </div><div class="line">  return Result;</div><div class="line">}</div><div class="line">  </div><div class="line">// ************************************************************************** //</div><div class="line">  </div><div class="line">Pixel vsFlat(Vertex _Value)</div><div class="line">{</div><div class="line">  float4x4 WorldViewProjection =</div><div class="line">    mul(ObjectData.World, mul(CameraData.View, CameraData.Projection));</div><div class="line">    </div><div class="line">  Pixel Result;</div><div class="line">  Result.ScreenPos = mul(_Value.Position, WorldViewProjection);</div><div class="line">  Result.Color = _Value.Extra;</div><div class="line">  Result.Normal = float3(0.0f, 0.0f, 1.0f);</div><div class="line">  Result.TexCoord = _Value.TexCoord;</div><div class="line">  Result.WorldPos = float4(0.0f, 0.0f, 0.0f, 1.0f);</div><div class="line">  return Result;</div><div class="line">}</div><div class="line">  </div><div class="line">Pixel vsVolume(Vertex _Value)</div><div class="line">{</div><div class="line">  float4x4 WorldViewProjection =</div><div class="line">    mul(ObjectData.World, mul(CameraData.View, CameraData.Projection));</div><div class="line">    </div><div class="line">   float3 Normal = normalize(</div><div class="line">    mul(ToFloat3(_Value.Extra), ToMatrix3x3(ObjectData.World)));</div><div class="line">  float4 WorldPos = mul(_Value.Position, ObjectData.World);</div><div class="line">    </div><div class="line">  Pixel Result;</div><div class="line">  Result.ScreenPos = mul(_Value.Position, WorldViewProjection);</div><div class="line">  Result.Color = GetAmbientDirectionColor(Normal);</div><div class="line">  Result.Normal = Normal;</div><div class="line">  Result.TexCoord = _Value.TexCoord;</div><div class="line">  Result.WorldPos = WorldPos;</div><div class="line">  return Result;</div><div class="line">}</div><div class="line">  </div><div class="line">#elif defined COVELLITE_SHADER_PIXEL ///////////////////////////////////////////</div><div class="line">  </div><div class="line">COVELLITE_DECLARE_TEX2D(TexDiffuse, 0);</div><div class="line">  </div><div class="line">float4 psColored(Pixel _Value)</div><div class="line">{</div><div class="line">  return _Value.Color;</div><div class="line">}</div><div class="line">  </div><div class="line">float4 CalcPointLight(Point_t _Light, float4 _Position, float3 _Normal)</div><div class="line">{</div><div class="line">  float4 Direction = _Light.Position - _Position;</div><div class="line">    </div><div class="line">  float LightFactor = max(dot(_Normal, normalize(ToFloat3(Direction))), 0.0f);</div><div class="line">  float4 Color = LightFactor * _Light.Color;</div><div class="line">  float Distance = length(Direction);</div><div class="line">    </div><div class="line">  float Attenuation =</div><div class="line">    _Light.Attenuation.x +</div><div class="line">    _Light.Attenuation.y * Distance +</div><div class="line">    _Light.Attenuation.z * Distance * Distance;</div><div class="line">    </div><div class="line">  return Color / Attenuation;</div><div class="line">}</div><div class="line">  </div><div class="line">float3 SyncSaturate(float3 _Color)</div><div class="line">{</div><div class="line">  float MaxXYZ = max(max(_Color.x, _Color.y), _Color.z);</div><div class="line">  if (MaxXYZ &lt; 1.0f) return _Color;</div><div class="line">    </div><div class="line">  return _Color / MaxXYZ;</div><div class="line">}</div><div class="line">  </div><div class="line">float4 psLightened(Pixel _Value)</div><div class="line">{</div><div class="line">  float4 LightColor = _Value.Color; // Ambient + Direction</div><div class="line">    </div><div class="line">  for (int i = 0; i &lt; ObjectData.Lights.Points.UsedSlotCount; i++)</div><div class="line">  {</div><div class="line">    LightColor += CalcPointLight(ObjectData.Lights.Points.Lights[i],</div><div class="line">      _Value.WorldPos, _Value.Normal);</div><div class="line">  }</div><div class="line">    </div><div class="line">  return COVELLITE_TEX2D_COLOR(TexDiffuse, _Value.TexCoord) *</div><div class="line">    float4(SyncSaturate(ToFloat3(LightColor)), 1.0f);</div><div class="line">}</div><div class="line">  </div><div class="line">#endif /////////////////////////////////////////////////////////////////////////</div></div><!-- fragment --><h2>Футер </h2>
<p>В конце тела шейдера добавляется определение функции, которая будет вызывать функцию, указанную в качестве параметра <b>entry</b> (это сделано для возможности создания единого унифицированного HLSL и GLSL тела шейдера).</p>
<h3>HLSL (вертексный шейдер)</h3>
<p>Ничего не добавляется, указанная функция вызывается напрямую.</p>
<h3>HLSL (пиксельный шейдер)</h3>
<div class="fragment"><div class="line">float4 psMain(Pixel _Value) : SV_Target</div><div class="line">{</div><div class="line">  <span class="keywordflow">return</span> entry(_Value);</div><div class="line">}</div></div><!-- fragment --><h3>GLSL (вертексный шейдер)</h3>
<div class="fragment"><div class="line">out Pixel PixelValue;</div><div class="line"><span class="keywordtype">void</span> main()</div><div class="line">{</div><div class="line">  Vertex InputData;</div><div class="line">  InputData.Position = Covellite_VertexPosition;</div><div class="line">  InputData.TexCoord = Covellite_VertexTexCoord;</div><div class="line">  InputData.Extra = Covellite_VertexExtra;</div><div class="line">  PixelValue = entry(InputData);</div><div class="line">  gl_Position = PixelValue.ScreenPos;</div><div class="line">}</div></div><!-- fragment --><h3>GLSL (пиксельный шейдер)</h3>
<div class="fragment"><div class="line">in Pixel PixelValue;</div><div class="line">out vec4 Covellite_OutPixelColor;</div><div class="line"><span class="keywordtype">void</span> main()</div><div class="line">{</div><div class="line">  Covellite_OutPixelColor = entry(PixelValue);</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Документация по Covellite++. Последние изменения: Пн 28 Окт 2019 16:22:12. Создано системой
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>

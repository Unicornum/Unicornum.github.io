<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Covellite++: Компонентная система</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Title.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Covellite++
   &#160;<span id="projectnumber">Version: 2.1.9 Revision: 1282 Platform: x64 Build: 22:33 01.02.2019</span>
   </div>
   <div id="projectbrief">Кроссплатформенный (Windows/Android) GUI фреймворк для разработки приложений на С++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Поиск');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Поиск');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a35269.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Компонентная система </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Используемые термины </h1>
<ul>
<li><b>Компонент</b> - объект, содержащий информацию об одном аспекте игрового объекта (таких как текстура, меш, положение и т.п.).</li>
<li><b>Игровой</b> <b>объект</b> - объект в игровом мире, содержащий информацию в виде набора компонентов.</li>
<li><b>Игровой</b> <b>мир</b> - набор игровых объектов, разбитый на иерархическую структуру из ячеек, каждая из которых содержит несколько игровых объектов; назначение - оптимизация подгрузки и выгрузки игровых объектов (сразу ячейками).</li>
<li><b>Игровая</b> <b>сцена</b> - набор игровых объектов, непосредственно участвующих в игровом процессе; объекты подгружаются (по мере необходимости) из игрового мира и это именно те объекты, которые должны обновляться в процессе игры.</li>
<li><b>Рендер</b> - объект, предназначенный для отображения игровых объектов в 3D сцене, создается на основе одного или набора нескольких компонентов.</li>
<li><b>Объект</b> <b>3D</b> <b>сцены</b> - объект (набор рендеров), из которых состоит 3D сцена.</li>
<li><b>3D</b> <b>сцена</b> - набор объектов 3D сцены, которые отображаются в окне программы; является 'зеркалом' той части объектов игровой сцены, которые попадают в поле зрения камеры.</li>
</ul>
<h1>Исходные требования </h1>
<ul>
<li>Не должно производиться никаких лишних действий (вызовов пустых функций), для каждого объекта (игрового и 3D сцены) должен выполнятся набор только ему необходимых действий.</li>
<li>Отсутствие дублирования информации (все объекты, отрисовываемые при помощи одного меша, должны содержать ссылку на единую область памяти с информацией об этом меше).</li>
</ul>
<h1>Компоненты </h1>
<p>Фреймворк предоставляет класс компонента <a class="el" href="a33984.html">Component</a>, а также механизм создания рендеров для этих компонентов с учетом активного графического Api (рендеры создаются через объект класса <a class="el" href="a34180.html">Renders</a>, который может быть получен при помощи функции GetRenders() класса <a class="el" href="a34196.html">Window</a>).</p>
<p>Класс компонента:</p><ul>
<li>Содержит и предоставляет доступ к параметрам, которые используются для создания рендеров.</li>
<li>Параметры (кроме обязательных) могут отсутствовать, для таких параметров предусмотрено задание значений по умолчанию.</li>
<li>Обязательный параметр <b>id</b> - идентификатор компонента. Для компонентов с одним и тем же идентификатором будет использоваться один и тот же рендер, поэтому объекты, содержащие один и тот же меш, могут содержать компоненты, у которых задан только (один и тот же) идентификатор, а развернутое описание этого компонента можно сделать в другом месте и создать его рендер заранее.</li>
<li>Обязательный параметр <b>type</b> - тип компонента, который определяет способ отрисовки этого компонента.</li>
<li>Параметр <b>kind</b> - дочерний подтип компонента; у некоторых типов не используется.</li>
<li>Первоначальная информация может загружаться в виде строк, в дальнейшем (для ускорения рендеринга) при обновлении игровых объектов значения параметров следует устанавливать того же типа, какой используют рендеры (подробнее см. в описании параметорв компонентов).</li>
</ul>
<dl class="section note"><dt>Заметки</dt><dd>Предполагается, что исходная информация о компоненте будет хранится в узлах xml файла, из которых параметры будут загружаться как атрибуты, у которых имя атрибута будет названием параметра, а значение атрибута - значением параметра.</dd></dl>
<h2>Типы компонентов </h2>
<h3>Data</h3>
<p>Вспомогательный компонент, предназначенный для передачи информации рендерам других типов.</p>
<dl class="section note"><dt>Заметки</dt><dd>Для этого компонента не создается рендера, вместо этого он захватывается и используется следующим рендером, который будет создан (какие данные нужны конкретным рендерам см. в описании соответствующих компонентов).</dd></dl>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">kind  </th><th class="markdownTableHeadNone">Параметры  </th><th class="markdownTableHeadNone">Тип параметра  </th><th class="markdownTableHeadNone">Описание параметра   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Position (<a class="el" href="a35269.html#Footnote">1</a>)  </td><td class="markdownTableBodyNone">x, y, z  </td><td class="markdownTableBodyNone">float  </td><td class="markdownTableBodyNone">Положение (координаты) в пространстве   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Rotation (<a class="el" href="a35269.html#Footnote">1</a>)  </td><td class="markdownTableBodyNone">x, y, z  </td><td class="markdownTableBodyNone">float  </td><td class="markdownTableBodyNone">Ориентация (углы поворота вокруг соответствующей оси в радианах) в пространстве   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Scale (<a class="el" href="a35269.html#Footnote">1</a>)  </td><td class="markdownTableBodyNone">x, y, z  </td><td class="markdownTableBodyNone">float  </td><td class="markdownTableBodyNone">Масштабирующие коэффициенты по соответствующим осям   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Direction (<a class="el" href="a35269.html#Footnote">1</a>)  </td><td class="markdownTableBodyNone">x, y, z  </td><td class="markdownTableBodyNone">float  </td><td class="markdownTableBodyNone">Вектор направления в пространстве   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Attenuation (<a class="el" href="a35269.html#Footnote">1</a>)  </td><td class="markdownTableBodyNone">const, linear, exponent  </td><td class="markdownTableBodyNone">float  </td><td class="markdownTableBodyNone">Настройки затухания для точечного источника света   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Rect (<a class="el" href="a35269.html#Footnote">1</a>)  </td><td class="markdownTableBodyNone">left, top, right, bottom  </td><td class="markdownTableBodyNone">int  </td><td class="markdownTableBodyNone">Границы прямоугольника   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="3">Texture  </td><td class="markdownTableBodyNone">data  </td><td class="markdownTableBodyNone">const uint8_t *  </td><td class="markdownTableBodyNone">Бинарные данные текстуры в формате R8G8B8A8   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">width  </td><td class="markdownTableBodyNone">int  </td><td class="markdownTableBodyNone">Ширина изображения в пикселях   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">height  </td><td class="markdownTableBodyNone">int  </td><td class="markdownTableBodyNone">Высота изображения в пикселях   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="4">Shader.HLSL  </td><td class="markdownTableBodyNone">data  </td><td class="markdownTableBodyNone">const uint8_t *  </td><td class="markdownTableBodyNone">Содержимое текстового файла шейдера DirectX в бинарном виде   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">count  </td><td class="markdownTableBodyNone">size_t  </td><td class="markdownTableBodyNone">Размер данных шейдера в байтах   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">version  </td><td class="markdownTableBodyNone">std::string  </td><td class="markdownTableBodyNone">Версия шейдера (вида 'ps_4_0')   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">entry  </td><td class="markdownTableBodyNone">std::string  </td><td class="markdownTableBodyNone">Имя функции точки входа шейдера   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="2">Vertex.Gui (<a class="el" href="a35269.html#Footnote">2</a>)  </td><td class="markdownTableBodyNone">data  </td><td class="markdownTableBodyNone">const <a class="el" href="a34188.html">Vertex::Gui</a> *  </td><td class="markdownTableBodyNone">Данные вертексного буфера   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">count  </td><td class="markdownTableBodyNone">size_t  </td><td class="markdownTableBodyNone">Размер данных вертексного буфера в байтах   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="2">Vertex.Textured  </td><td class="markdownTableBodyNone">data  </td><td class="markdownTableBodyNone">const <a class="el" href="a34192.html">Vertex::Textured</a> *  </td><td class="markdownTableBodyNone">Данные вертексного буфера   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">count  </td><td class="markdownTableBodyNone">size_t  </td><td class="markdownTableBodyNone">Размер данных вертексного буфера в байтах   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="2">Index  </td><td class="markdownTableBodyNone">data  </td><td class="markdownTableBodyNone">const int *  </td><td class="markdownTableBodyNone">Данные индексного буфера   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">count  </td><td class="markdownTableBodyNone">size_t  </td><td class="markdownTableBodyNone">Размер данных индексного буфера в байтах   </td></tr>
</table>
<dl class="todo"><dt><b><a class="el" href="a33833.html#_todo000004">Необходимо сделать:</a></b></dt><dd>Для шейдеров, текстур, вертексных и индексных буферов добавить параметр - имя файла, из которого должны быть загружены данные.</dd></dl>
<h3>State</h3>
<p>Компонент изменения состояния конвеера рендеринга.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">kind  </th><th class="markdownTableHeadCenter">Требуется Data (kind)  </th><th class="markdownTableHeadCenter">Параметры  </th><th class="markdownTableHeadCenter">Тип параметра  </th><th class="markdownTableHeadNone">Описание параметра   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Blend  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Sampler  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Scissor  </td><td class="markdownTableBodyCenter">Rect  </td><td class="markdownTableBodyCenter">is_enabled  </td><td class="markdownTableBodyCenter">bool  </td><td class="markdownTableBodyNone">В случае false Data.Rect не нужен   </td></tr>
</table>
<dl class="section note"><dt>Заметки</dt><dd>Каждая камера при рендеринге отключает блендинг.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="a33833.html#_todo000005">Необходимо сделать:</a></b></dt><dd>Получение параметров Blend и Sampler - через компонент Data.</dd></dl>
<h3><a class="el" href="a33869.html" title="Входит в проект Covellite.Api   Пространство имен структур для передачи шейдеру информации об источни...">Light</a></h3>
<p>Компонент источника света.</p>
<p>Логика использования источников света предполагает:</p><ul>
<li>Активация рендера камеры создает новую сцену, в которой по умолчанию источники света отсутствуют (поэтому, если - например - требуется отрисовать несколько объектов без использования освещения, следует выделить их в отдельную сцену со своей уникальной камерой).</li>
<li>Компоненты источников света могут располагаться в любом месте списка объектов при создании рендеров (при этом необходимо учитывать, что рендеры источников света добавляют информацию о себе в список источников света текущей сцены (другими словами - активной камеры), а при рендеринге текущего кадра используются источники света, установленные во время рендеринга предыдущего кадра).</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">kind  </th><th class="markdownTableHeadNone">Требуется Data (kind)  </th><th class="markdownTableHeadNone">Параметры  </th><th class="markdownTableHeadNone">Тип параметра  </th><th class="markdownTableHeadNone">Описание параметра   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="3">Ambient  </td><td class="markdownTableBodyNone" rowspan="3">-  </td><td class="markdownTableBodyNone">ambient  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">diffuse  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">specular  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="3">Direction  </td><td class="markdownTableBodyNone" rowspan="3">Direction  </td><td class="markdownTableBodyNone">ambient  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">diffuse  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">specular  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="3">Point  </td><td class="markdownTableBodyNone" rowspan="3">Position, Attenuation  </td><td class="markdownTableBodyNone">ambient  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">diffuse  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">specular  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
</table>
<dl class="section note"><dt>Заметки</dt><dd><ul>
<li>Фоновых и направленных источников света может быть не более одного, точечных может быть несколько.</li>
<li>Пропущенные параметры устанавливаются в 0xFF000000.</li>
<li>Параметры компонента Data.Attenuation используются следующим образом: <br />
 bright = color / (const + linear * distance + exponent * distance * distance).</li>
<li>При удалении точечных источников света из 3D сцены следует учитывать, что источник света, не попадающий в поле зрения камеры тем не менее может освещать объекты, попадающие в поле зрения камеры.</li>
<li>Если используется рендеринг при помощи шейдеров (DirectX10/11), то информация об источниках света просто передается пиксельному шейдеру и необходимо самостоятельно задействовать эту информацию в шейдере (форматы передачи данных шейдерам см. <a class="el" href="a33837.html">Fx</a>); также для рендеринга сцены без источников света следует использовать пиксельный шейдер, который не использует информацию об источниках света.</li>
</ul>
</dd></dl>
<h3>Material</h3>
<p>Компонент материала (нужен для расчета освещения).</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Параметры  </th><th class="markdownTableHeadNone">Тип параметра  </th><th class="markdownTableHeadNone">Описание параметра   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ambient  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">diffuse  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">specular  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">emission  </td><td class="markdownTableBodyNone">uint32_t  </td><td class="markdownTableBodyNone">Цвет в формате ARGB (0xFF00FF00)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">shininess  </td><td class="markdownTableBodyNone">int32_t  </td><td class="markdownTableBodyNone">Значение в диапазоне 0...0x80   </td></tr>
</table>
<dl class="section note"><dt>Заметки</dt><dd><ul>
<li>Материал должен устанавливаться для каждого объекта 3D сцены, которому требуется рассчет освещения.</li>
<li>Рекомендуется заранее подготовить набор используемых в сцене рендеров материалов (дерево, металл, камень, пластик и т.п.) и в дальнейшем использовать рендеры этих компонентов.</li>
<li>Пропущенные параметры устанавливаются в 0xFF000000.</li>
<li>Если используется рендеринг при помощи шейдеров (DirectX10/11):<ul>
<li>Информация о материале объекта просто передается шейдеру и необходимо самостоятельно задействовать эту информацию в пиксельном шейдере (форматы передачи данных шейдерам см. <a class="el" href="a33837.html">Fx</a>).</li>
<li>Компонент материала при создании рендеров должен располагаться после пиксельного шейдера.</li>
</ul>
</li>
</ul>
</dd></dl>
<h3>Texture</h3>
<p>Компонент текстуры.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">kind  </th><th class="markdownTableHeadNone">Требуется Data (kind)  </th><th class="markdownTableHeadNone">Параметры  </th><th class="markdownTableHeadNone">Тип параметра  </th><th class="markdownTableHeadNone">Описание параметра   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">Texture (<a class="el" href="a35269.html#Footnote">3</a>)  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">-   </td></tr>
</table>
<dl class="todo"><dt><b><a class="el" href="a33833.html#_todo000006">Необходимо сделать:</a></b></dt><dd>Параметр для указания индекса текстуры при мультитекстурировании.</dd></dl>
<h3>Shader</h3>
<p>Компонент шейдера.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">kind  </th><th class="markdownTableHeadNone">Требуется Data (kind)   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Vertex.Gui (<a class="el" href="a35269.html#Footnote">4</a>)  </td><td class="markdownTableBodyNone">Shader.HLSL (<a class="el" href="a35269.html#Footnote">3</a>)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Vertex.Textured (<a class="el" href="a35269.html#Footnote">5</a>)  </td><td class="markdownTableBodyNone">Shader.HLSL (<a class="el" href="a35269.html#Footnote">3</a>)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Pixel  </td><td class="markdownTableBodyNone">Shader.HLSL (<a class="el" href="a35269.html#Footnote">3</a>)   </td></tr>
</table>
<p>Всем шейдерам в качестве заголовочных файлов передаются:</p><ul>
<li>Файл, содержащий описания структур для передачи данных шейдеру (<a class="el" href="a33837.html">Fx</a>).</li>
<li>Файл, содержащий описания входных данных вертексного шейдера</li>
</ul>
<div class="fragment"><div class="line"></div><div class="line">// Используется совместно с covellite::api::Vertex::Gui</div><div class="line">struct VertexGui</div><div class="line">{</div><div class="line">  float2 Position : POSITION;</div><div class="line">  uint Color : COLOR;</div><div class="line">  float2 TexCoord : TEXCOORD;</div><div class="line">};</div><div class="line">  </div><div class="line">// Используется совместно с covellite::api::Vertex::Textured</div><div class="line">struct VertexTextured</div><div class="line">{</div><div class="line">  float3 Position : POSITION;</div><div class="line">  float3 Normal : NORMAL;</div><div class="line">  float2 Texture : TEXCOORD;</div><div class="line">};</div><div class="line"></div></div><!-- fragment --> <h3>Buffer</h3>
<p>Компонент буферов геометрии меша.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">kind  </th><th class="markdownTableHeadNone">Требуется Data (kind)   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Vertex.Gui (<a class="el" href="a35269.html#Footnote">4</a>)  </td><td class="markdownTableBodyNone">Vertex.Gui (<a class="el" href="a35269.html#Footnote">3</a>)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Vertex.Textured (<a class="el" href="a35269.html#Footnote">5</a>)  </td><td class="markdownTableBodyNone">Vertex.Textured (<a class="el" href="a35269.html#Footnote">3</a>)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Index  </td><td class="markdownTableBodyNone">Index (<a class="el" href="a35269.html#Footnote">3</a>)   </td></tr>
</table>
<h3>Present</h3>
<p>Компонент отправки информации в конвеер рендеринга.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">kind  </th><th class="markdownTableHeadNone">Требуется Data (kind)  </th><th class="markdownTableHeadNone">Параметры  </th><th class="markdownTableHeadNone">Тип параметра  </th><th class="markdownTableHeadNone">Описание параметра   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="4">Camera (<a class="el" href="a35269.html#Footnote">6</a>)  </td><td class="markdownTableBodyNone" rowspan="4">Position, Rotation (<a class="el" href="a35269.html#Footnote">7</a>)  </td><td class="markdownTableBodyNone">distance  </td><td class="markdownTableBodyNone">float  </td><td class="markdownTableBodyNone">Расстояние от позиции, заданной компонентом Data.Position до камеры   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">angle  </td><td class="markdownTableBodyNone">float  </td><td class="markdownTableBodyNone">Угол поля зрения по вертикали в градусах   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dept  </td><td class="markdownTableBodyNone">String  </td><td class="markdownTableBodyNone">Enabled - включает использование буфера глубины   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">focal  </td><td class="markdownTableBodyNone">String  </td><td class="markdownTableBodyNone">Enabled - включает использование перспективной проекции   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Geometry (<a class="el" href="a35269.html#Footnote">8</a>)  </td><td class="markdownTableBodyNone">Position, Rotation, Scale (<a class="el" href="a35269.html#Footnote">9</a>)  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">-  </td><td class="markdownTableBodyNone">-   </td></tr>
</table>
<h2>Сноски </h2>
<p><a class="anchor" id="Footnote"></a></p><ol type="1">
<li>Параметры этих компонентов могут изменяться во время работы программы (т.е. для изменения положения объекта в пространстве не нужно его пересоздавать, достаточно установить новые координаты комопоненту его положения), для изменения остальных (например замены 3D модели объекта) необходимо создать новый набор компонентов, удалить из 3D сцены старый и создать новый объект.</li>
<li><a class="el" href="a34188.html">Vertex::Gui</a> создан специально для рендеринга элементов Gui и соответствует формату данных, получаемых от libRocket.</li>
<li>Параметр <b>file</b> можно передавать ТОЛЬКО через компонента Data, все остальные параметры можно указывать непосредственно основному компоненту, без использования компонента Data.</li>
<li>Если вертексный буфер меша передается как <a class="el" href="a34188.html">Vertex::Gui</a>.</li>
<li>Если вертексный буфер меша передается как <a class="el" href="a34192.html">Vertex::Textured</a>.</li>
<li>Предполагается, что камера 'смотрит' в точку, заданную компонентом Data.Position с расстояния <b>distance</b> с учетом ориентации, заданной компонентом Data.Rotation (если нужен вид 'от первого лица', установить distance в ноль).</li>
<li>Отсутствие компонента Data.Rotation или нулевые значения углов ориентации соответствуют направлению взгляда из точки, смещенной от Data.Position на (distance, 0.0f, 0.0f).</li>
<li>Компонент должен завершать набор компонентов каждого объекта 3D сцены и должен иметь уникальный id для каждого конкретного объекта.</li>
<li>Может быть несколько компонентов, что можно использовать для привязки (совместного движения) объектов друг к другу (в этом случае необходимо гарантировать, чтобы в качестве общего компонента использовался ОДИН И ТОТ ЖЕ объект, совпадения идентификаторов компонентов недостаточно!).</li>
</ol>
<h1>Общая концепция использования компонентов </h1>
<p>Основная идея работы с 3D объектами предполагает использование архитектуры программы на основе паттерна MVC.</p>
<h2>Модель </h2>
<ul>
<li>Загружает игровой мир как набор ячеек, каждая из которых ссылается на место хранения информации о содержащихся в ячейке объектах.</li>
<li>Содержит базу данных игровых объектов и функции, которые позволяют получать набор компонентов (для обновления и рендеринга) игрового объекта по его идентификатору.</li>
<li>Содержит игровую сцену(ы), которая включает идентификаторы камеры, а также источников света и объектов, находящихся рядом с камерой.</li>
<li>При перемещениях игрока добавляются приблизившиеся к камере и удаляются удалившиеся объекты (группами в ячейках).</li>
<li>На стадии обновления обновляются объекты игровой сцены (можно обновлять объекты постепенно удаляясь от камеры пока не выйдет заданное на обновление время).</li>
<li>Состояние 3D сцены является отражением состояния игрового мира, поэтому компоненты рендеров удаляются из 3D сцены при удалении из игрового мира ячеек, содержащих описания этих компонентов.</li>
</ul>
<h2>Представление </h2>
<ul>
<li>Класс окна, которое создается между окнами Api и Gui.</li>
<li>Содержит, создает и удаляет объекты 3D сцены на основе информации, полученной от модели.</li>
<li>При построении/обновлении 3D сцены первой должна идти камера.</li>
<li>Изменение геометрии/материала производится удалением/добавлением игрового объекта.</li>
</ul>
<h2>Взаимодействие частей кода игры </h2>
<ul>
<li>Панель GUI с кнопками действий игрока (View) подписывается на события нажатия кнопок, при нажатии которых вызывает соответствующие функции модели, после чего активирует событие обновления 3D сцены.</li>
<li>Игровая сцена (Model) при действии игрока:<ul>
<li>Очищается от объектов, ранее помеченных для удаления.</li>
<li>Обновляет состояние оставшихся объектов.</li>
<li>Объекты, которые выпадают из зоны действия камеры, помечаются на удаление.</li>
<li>Добавляются объекты, которые теперь попадают в зону действия камеры.</li>
</ul>
</li>
<li>По событию обновления 3D сцены, она:<ul>
<li>Запрашивает у модели изменения набора активных объектов.</li>
<li>Удаляет объекты, которые больше не попадают в поле зрения камеры.</li>
<li>Добавляет объекты, которые попали в поле зрения камеры.</li>
<li>Рендерит актуальный набор объектов.</li>
</ul>
</li>
</ul>
<h1>Примеры использования компонентов </h1>
<dl class="todo"><dt><b><a class="el" href="a33833.html#_todo000007">Необходимо сделать:</a></b></dt><dd>Пример формирования сцены из набора компонентов. </dd></dl>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">notitle</a></li><li class="navelem"><a class="el" href="a35267.html">Структура решения</a></li><li class="navelem"><a class="el" href="a35271.html">Covellite.Api</a></li>
    <li class="footer">Документация по Covellite++. Последние изменения: Пт 1 Фев 2019 22:33:32. Создано системой
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Covellite++: Использование фреймворка</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Title.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Covellite++
   &#160;<span id="projectnumber">Версия: 1.1.0 Revision: 300 Platform: ARM Build: 19:37 16 Сентябрь 2017</span>
   </div>
   <div id="projectbrief">GUI фреймворк для разработки Android-приложений на С++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Поиск');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Поиск');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a32002.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Использование фреймворка </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Подключение к проекту </h2>
<p>Для подключения фреймворка к реальному проекту:</p><ul>
<li>Установить свойство svn:externals с именем Covellitepp и путем <div class="fragment"><div class="line">https:<span class="comment">//svn/svn/Covellitepp/trunk/Solution/Solution/Covellite</span></div></div><!-- fragment --></li>
<li>Подключить к Solution.ARM.props файл Lib.props из экспортированной папки.</li>
</ul>
<h1>Использование фреймворка </h1>
<ul>
<li>Создать проект сборки .apk файла.</li>
<li>Создать проект сборки главного модуля программы.</li>
<li>Создать css и html файлы описания отдельных экранов программы.</li>
<li>Создать класс главного окна программы.</li>
<li>Создать класс программы.</li>
</ul>
<h2>Создание проекта сборки .apk файла программы </h2>
<div class="image">
<img src="Vs2015.Simple.png" alt="Vs2015.Simple.png"/>
</div>
<p>Создать "Простое приложение Android", добавить в его java код перехват функции dispatchKeyEvent() (как это делается и зачем это нужно, см. <a class="el" href="a31993.html">Ввод русских букв с клавиатуры</a>).</p>
<p><a class="el" href="a31991.html">Фоновое выполнение задач в коде С++</a></p>
<h2>Создание проекта сборки главного модуля программы </h2>
<div class="image">
<img src="Vs2015.So.png" alt="Vs2015.So.png"/>
</div>
<p>Создать проект .so файла (который будет загружаться при старте NativeActivity), проекту Packaging добавить его в ссылки, а в AndroidManifest.xml добавить запись загрузки именно этого модуля (подробнее см. <a class="el" href="a31993.html">Ввод русских букв с клавиатуры</a>).</p>
<h2>Создание css и html файлов описания отдельных экранов программы </h2>
<p>Как это делается см. в документации/примерах <a href="https://github.com/libRocket/libRocket" title="libRocket">libRocket</a>. <br />
 Доступные css свойства: <a href="http://librocket.com/wiki/documentation/RCSS" title="libRocket CSS">libRocket CSS</a>.</p>
<p>Все файлы (.rml, .rcss, .png) следует поместить в папку assets проекта Packaging (пути к этим файлам в программе задаются относительно этой папки, а в самом файле - относительно папки расположения файла).</p>
<p>Файлы .rml могут содержать в качестве текста не ASCII символы, но в этом случае их следует сохранять как utf8, а используемые шрифты должны поддерживать соответствующие Unicode символы.</p>
<h2>Создание класса главного окна программы </h2>
<p>Класс главного окна программы отвечает за отрисовку окна, переключение пользовательских экранов и обработку пользовательского ввода.</p>
<p>Создать класс-наследник от класса <a class="el" href="a31857.html" title="Класс входит в проект Covellite.Rocket   Класс окна, отрисовывающий GUI при помощи libRocket...">covellite::rocket::Window</a>, в конструкторе котрого загрузить используемые шрифты, подписаться на нужные события и добавить стартовый экран (<a class="el" href="a31821.html" title="Класс входит в проект Covellite.Rocket   Класс одного слоя (пользовательского экрана) программы...">covellite::rocket::Layer</a>) программы.</p>
<div class="fragment"><div class="line"><a class="code" href="a31925.html#a8e7cb0a00ebd24e4976bc943847fe153">ExampleWindow::ExampleWindow</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  <span class="comment">// Загрузка шрифтов, используемых в .rml</span></div><div class="line">  <a class="code" href="a31857.html#a2508378c24952f10bfc35e1ec235b7aa">LoadFontFace</a>(<span class="stringliteral">&quot;Times New Roman.ttf&quot;</span>);</div><div class="line">  <a class="code" href="a31857.html#a2508378c24952f10bfc35e1ec235b7aa">LoadFontFace</a>(<span class="stringliteral">&quot;Ubuntu.ttf&quot;</span>);</div><div class="line">    </div><div class="line">  using ::std::placeholders::_1;</div><div class="line">  </div><div class="line">  <span class="comment">// Подписка на событие отрисовки экрана (в начальный слот, чтобы</span></div><div class="line">  <span class="comment">// функция этого класса вызывалась перед отрисовкой элементов управления).</span></div><div class="line">  <a class="code" href="a31581.html#a67c90573b7ade09256572a69cc445f7a">OnDrawWindow</a>.connect(::std::bind(&amp;<a class="code" href="a31925.html#ad785027ce412f98e0325ea82214712c6">ExampleWindow::ProcessDrawWindow</a>, <span class="keyword">this</span>),</div><div class="line">    ::boost::signals2::at_front);</div><div class="line">  <span class="comment">// Подписка на события выбора элементов управления.</span></div><div class="line">  <a class="code" href="a31777.html#a489436470543f9ff21a8da4fc7577f61">OnClick</a>.connect(::std::bind(&amp;<a class="code" href="a31925.html#a8867c85c2ed1e44dec804eaa5e4672f1">ExampleWindow::ProcessClick</a>, <span class="keyword">this</span>, _1));</div><div class="line">  <span class="comment">// Сигнал вызывается при возникновении исключения во время выполнения любого</span></div><div class="line">  <span class="comment">// другого сигнала.</span></div><div class="line">  <a class="code" href="a31581.html#a8282cec332f1b34bef202b4ec64a5bfb">OnError</a>.connect(&amp;<a class="code" href="a31925.html#ac7a3302cf825f0ff205137311b4f5e03">ExampleWindow::ProcessError</a>);</div><div class="line">     </div><div class="line">  <span class="comment">// Слой, который будет отображаться при старте программы.</span></div><div class="line">  AddLayer&lt;DemoLayer1&gt;();</div><div class="line">}</div></div><!-- fragment --><p> Если необходим экран с заголовком, содержащим текст, заданный в заголовке .rml файла, создать класс наследник слоя, в конструкторе которого передать базовому классу идентификатор заголовка из его объявления в .rml файле.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="a31909.html">ExampleWindow::DemoLayer1</a> final :</div><div class="line">  <span class="keyword">public</span> Layer_t</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="comment">// cppcheck-suppress unusedFunction</span></div><div class="line">  <span class="keyword">static</span> Path_t GetPathToFile(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <span class="stringliteral">&quot;demo.rml&quot;</span>; }</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="keyword">explicit</span> DemoLayer1(Document_t * _pDocument) : </div><div class="line">    Layer_t(_pDocument, <span class="stringliteral">&quot;title&quot;</span>) </div><div class="line">  {</div><div class="line">    ::alicorn::system::version::Info Info;</div><div class="line">    <span class="keyword">using namespace </span>::alicorn::extension::std;</div><div class="line"></div><div class="line">    <a class="code" href="a31821.html#a2dc558bad1d0ae39587f5d543d5d2d7a">GetElement</a>(<span class="stringliteral">&quot;id_header&quot;</span>).SetText(</div><div class="line">      <span class="stringliteral">&quot;&lt;h1&gt;Covellite++ v&quot;</span> + string_cast&lt;::std::string, Locale::UTF8&gt;(</div><div class="line">        Info.GetValue(uT(<span class="stringliteral">&quot;FileVersionShort&quot;</span>))) + <span class="stringliteral">&quot;&lt;/h1&gt;&quot;</span>);</div><div class="line">  }</div><div class="line">};</div></div><!-- fragment --> <dl class="section note"><dt>Заметки</dt><dd>Подписка на событие OnDrawWindow() необходима, т.к. фреймворк рисует только сами элементы управления и поэтому программа должна сначала заполнить окно (минимум - очистить его нужным цветом; игра должна отрисовывать очередной кадр).</dd></dl>
<p>Закрашивание окна синим цветом:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="a31925.html#ad785027ce412f98e0325ea82214712c6">ExampleWindow::ProcessDrawWindow</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  <span class="comment">// Очищаем экран (также здесь можно что-либо нарисовать на экране,</span></div><div class="line">  <span class="comment">// GUI будет отрисован поверх того, что будет нарисовано здесь).</span></div><div class="line">  </div><div class="line">  glDisable(GL_BLEND);</div><div class="line">  </div><div class="line">  glClearColor(0.0f, 0.0f, 1.0f, 1.0f);</div><div class="line">  glClear(GL_COLOR_BUFFER_BIT);</div><div class="line">}</div></div><!-- fragment --> <dl class="section note"><dt>Заметки</dt><dd>Вообще говоря, цвет фона можно задавать как поле <b>background-color</b> для body в .rcss файле, но в этом случае для заполнения всего окна следует в стилях rml и body поставить <div class="fragment"><div class="line">rml</div><div class="line">{</div><div class="line">  top: 0px;</div><div class="line">  left: 0px;</div><div class="line">  width: 100%;</div><div class="line">  height: 100%;</div><div class="line">}</div><div class="line">  </div><div class="line">body</div><div class="line">{</div><div class="line">  top: 0px;</div><div class="line">  left: 0px;</div><div class="line">  width: 100%;</div><div class="line">  height: 100%;</div><div class="line">  background-color: blue;</div></div><!-- fragment --></dd></dl>
<p>Событие OnClick() происходит при нажатии пользователем элемента управления в текущем окне (параметр события - идентификатор элемента управления, заданный как атрибут 'id' в .rml файле).</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="a31925.html#a8867c85c2ed1e44dec804eaa5e4672f1">ExampleWindow::ProcessClick</a>(<span class="keyword">const</span> TargetInfo &amp; _Info)</div><div class="line">{</div><div class="line">  LOGGER(Info) &lt;&lt; <span class="stringliteral">&quot;Click on &quot;</span> &lt;&lt; _Info.m_Id.c_str();</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (_Info.m_Id == <span class="stringliteral">&quot;button1&quot;</span>)</div><div class="line">  {</div><div class="line">    LOGGER(Info) &lt;&lt; <span class="stringliteral">&quot;Go to layer 2.&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Нажата кнопка перехода к другому слою, вставляем его (обратный переход</span></div><div class="line">    <span class="comment">// будет произведен автоматически при нажатии кнопки &quot;Назад&quot;).</span></div><div class="line">    AddLayer&lt;DemoLayer2&gt;();</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_Info.m_Id == <span class="stringliteral">&quot;button2&quot;</span>)</div><div class="line">  {</div><div class="line">    LOGGER(Info) &lt;&lt; <span class="stringliteral">&quot;Go to table layer&quot;</span>;</div><div class="line"></div><div class="line">    AddLayer&lt;TableLayer&gt;();</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_Info.m_Id == <span class="stringliteral">&quot;button3&quot;</span>)</div><div class="line">  {</div><div class="line">    LOGGER(Info) &lt;&lt; <span class="stringliteral">&quot;Go to scroll layer&quot;</span>;</div><div class="line"></div><div class="line">    AddLayer&lt;ScrollLayer&gt;();</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (_Info.m_Id == <span class="stringliteral">&quot;exit&quot;</span>)</div><div class="line">  {</div><div class="line">    LOGGER(Info) &lt;&lt; <span class="stringliteral">&quot;Exit from program.&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Завершение работы программы.</span></div><div class="line">    <a class="code" href="a31613.html#a6609414193afcde800799469e4d86bcb">Exit</a>();</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --> <dl class="section note"><dt>Заметки</dt><dd>Идентификаторы элементов управления передаются в OnClick() в нижнем регистре, независимо от того, каким образом они были заданы в .rml файле.</dd></dl>
<p>В классе окна событие OnClick() будет вызываться для всех элементов управления всех активных пользовательских экранов, при этом здесь имеет смысл обрабатывать события, непосредственно связанные с работой окна (переход к другому слою, вызов клавиатуры, выход из программы).</p>
<p>Для каждого пользовательского экрана можно создать отдельный класс-наследник от <a class="el" href="a31821.html" title="Класс входит в проект Covellite.Rocket   Класс одного слоя (пользовательского экрана) программы...">covellite::rocket::Layer</a>, в котором событие OnClick() будет вызываться только для элементов управления только этого слоя (это позволит создавать элементы управления с уникальными идентификаторами в пределах одного слоя).</p>
<p>Другие события, которые может обрабатывать окно, см. в описании классов <a class="el" href="a31581.html" title="Класс входит в проект Covellite.Core   Класс обработки событий окна программы. ">covellite::EventHandler</a>, <a class="el" href="a31613.html" title="Класс входит в проект Covellite.Core   Базовый класс главного окна программы. ">covellite::Window</a> и <a class="el" href="a31777.html" title="Класс входит в проект Covellite.Rocket   Класс, обеспечивающий подписку на события элементов управлен...">covellite::rocket::ElementEvents</a>.</p>
<p>Если требуется изменять текст элементов управления, заданный в .rml файле в зависимоcти от, например, выбранного языка, переопределить функцию <a class="el" href="a31857.html#afcffdc06542a49f7f29eea2b757fc1d2" title="Функция для преобразования строк, прочитанных из .rml файла в строки, отображаемые на экране...">covellite::rocket::Window::Translate()</a>, в которой реализовать необходимое преобразование строк.</p>
<div class="fragment"><div class="line">ExampleWindow::Utf8String_t <a class="code" href="a31925.html#aa4837fa48c84eb982b4b4576c680c199">ExampleWindow::Translate</a>(</div><div class="line">  <span class="keyword">const</span> Utf8String_t &amp; _Source) <span class="comment">/*override*/</span></div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (_Source == <span class="stringliteral">&quot;[HELLO]&quot;</span>) <span class="keywordflow">return</span> u8<span class="stringliteral">&quot;Привет&quot;</span>;</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> _Source;</div><div class="line">}</div></div><!-- fragment --> <h2>Создание класса программы </h2>
<p>Класс программы содержит главный цикл обработки сообщений, отвечает за обработку системных сообщений и создание/разрушение главного окна программы.</p>
<dl class="section note"><dt>Заметки</dt><dd>При написании кода следует учитывать, что NativeActivity загружает главный модуль программы только один раз, при первом запуске программы, после чего при каждой последующей активации программы вызывает функцию точки входа. При этом объект класса программы будет создаваться каждый раз заново, но все статические объекты будут иметь состояния, унаследованные от предыдущей активации.</dd></dl>
<p>Создать класс-наследник от <a class="el" href="a31561.html" title="Класс входит в проект Covellite.Core   Базовый класс приложения для Android. ">covellite::Application</a>, в конструкторе которого подписаться на необходимые события и добавить код обработки этих событий.</p>
<div class="fragment"><div class="line"><a class="code" href="a31905.html#ad68d51b325f5fc02a1b9d1e3a7005339">ExampleApp::ExampleApp</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  OnSignals[<a class="code" href="a31521.html#ggadf764cbdea00d65edcd07bb9953ad2b7a0d6fca4488718da1af972b5eb76b4e70">APP_CMD_INIT_WINDOW</a>].connect(</div><div class="line">    ::std::bind(&amp;<a class="code" href="a31905.html#af59cb0f17db312f9791d25699d6a3b40">ExampleApp::OnInitWindow</a>, <span class="keyword">this</span>));</div><div class="line">  OnError.connect(</div><div class="line">    &amp;<a class="code" href="a31905.html#a5c6ee877ad721415ed12a18f05f7afb0">ExampleApp::DoProcessError</a>);</div><div class="line">  <span class="comment">// ...</span></div></div><!-- fragment --><p> Список получаемых событий см. в <a class="el" href="a31521.html#aSystemCommand">aSystemCommand</a></p>
<dl class="section note"><dt>Заметки</dt><dd>Подписка на событие <b>APP_CMD_INIT_WINDOW</b> обязательна, в обработчике следует вызвать функцию создания главно окна программы; в качестве класса главного окна программы следует указать ранее созданный класс. <br />
 Подписка на собыие <b>APP_CMD_TERM_WINDOW</b> не требуется, окно будет уничтожено автоматически.</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="a31905.html#af59cb0f17db312f9791d25699d6a3b40">ExampleApp::OnInitWindow</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  LOGGER(Info) &lt;&lt; <span class="stringliteral">&quot;Create main window.&quot;</span>;</div><div class="line"></div><div class="line">  CreateMainWindow&lt;ExampleWindow&gt;();</div><div class="line">}</div></div><!-- fragment --><p> Для создания точки входа программы использовать макросы <b>ANDROID_APP_DRAW_AFTER_MESSAGE</b> или <b>ANDROID_APP_DRAW_ALWAYS</b>, в качестве параметра которым передать имя созданного класса программы.</p>
<div class="fragment"><div class="line"><a class="code" href="a31521.html#ga3bb90da4f341bb1bb64a62ff2cc2420a">ANDROID_APP_DRAW_AFTER_MESSAGE</a>(<a class="code" href="a31905.html">ExampleApp</a>);</div></div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Главная страница документации</a></li><li class="navelem"><a class="el" href="a32000.html">Covellite++</a></li>
    <li class="footer">Документация по Covellite++. Последние изменения: Сб 16 Сен 2017 19:37:40. Создано системой
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>

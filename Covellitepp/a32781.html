<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Covellite++: Использование фреймворка</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Title.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Covellite++
   &#160;<span id="projectnumber">Версия: 2.0.5 Revision: 508 Platform: x64 Build: 11:36 03 Ноябрь 2017</span>
   </div>
   <div id="projectbrief">Кроссплатформенный (Windows/Android) GUI фреймворк для разработки приложений на С++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Поиск');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Поиск');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a32781.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Использование фреймворка </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Подключение к проекту </h2>
<p>Для подключения фреймворка к реальному проекту:</p><ul>
<li>Установить свойство svn:externals с именем Externals и путем <div class="fragment"><div class="line">https:<span class="comment">//svn/svn/Prebuilt.no.backup/Solution/Solution</span></div></div><!-- fragment --></li>
<li>Подключить к Solution.ARM.props файл Covellite++.props из папки Externals/Covellite.</li>
</ul>
<h1>Использование фреймворка </h1>
<ul>
<li>Создать проект сборки .apk файла.</li>
<li>Создать проект сборки главного модуля программы.</li>
<li>Создать .rcss и .rml файлы описания отдельных экранов программы.</li>
<li>Создать классы отдельных экранов программы.</li>
<li>Создать класс главного окна программы.</li>
<li>Создать класс программы.</li>
</ul>
<h2>Создание проекта сборки .apk файла программы </h2>
<div class="image">
<img src="Vs2015.Simple.png" alt="Vs2015.Simple.png"/>
</div>
<p>Создать "Простое приложение Android", добавить в его java код перехват функции dispatchKeyEvent() (как это делается и зачем это нужно, см. <a class="el" href="a32772.html">Ввод русских букв с клавиатуры</a>).</p>
<p><a class="el" href="a32770.html">Фоновое выполнение задач в коде С++</a></p>
<h2>Создание проекта сборки главного модуля программы </h2>
<div class="image">
<img src="Vs2015.So.png" alt="Vs2015.So.png"/>
</div>
<p>Создать проект .so файла (который будет загружаться при старте NativeActivity), проекту Packaging добавить его в ссылки, а в AndroidManifest.xml добавить запись загрузки именно этого модуля (подробнее см. <a class="el" href="a32772.html">Ввод русских букв с клавиатуры</a>).</p>
<h2>Создание .rcss и .rml файлов описания отдельных экранов программы </h2>
<p>Как это делается см. в документации/примерах <a href="https://github.com/libRocket/libRocket" title="libRocket">libRocket</a>. <br />
 Доступные css свойства: <a href="http://librocket.com/wiki/documentation/RCSS" title="libRocket CSS">libRocket CSS</a>.</p>
<p>Все файлы (.rml, .rcss, .png) следует поместить в папку assets проекта Packaging (пути к этим файлам в программе задаются относительно этой папки, а в самом файле - относительно папки расположения файла).</p>
<p>Файлы .rml могут содержать в качестве текста не ASCII символы, но в этом случае их следует сохранять как utf8, а используемые шрифты должны поддерживать соответствующие Unicode символы.</p>
<h2>Создать классы отдельных экранов программы </h2>
<p>Для каждого экрана программы необходимо создать класс-наследник от класса <a class="el" href="a32556.html" title="Класс входит в проект Covellite.Rocket   Класс одного слоя (пользовательского экрана) программы...">covellite::rocket::Layer</a>, передав ему в качестве второго параметра конструктора путь к соответствующему .rml файлу.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="a32664.html">ExampleWindow::DemoLayer2</a> final :</div><div class="line">  <span class="keyword">public</span> Layer_t</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="comment">// Интерфейс IWindow:</span></div><div class="line">  <span class="keywordtype">void</span> Subscribe(<span class="keyword">const</span> EventHandlerPtr_t &amp; _pEvents)<span class="keyword"> override</span></div><div class="line"><span class="keyword">  </span>{</div><div class="line">    using ::covellite::core::Event;</div><div class="line">    using ::std::placeholders::_1;</div><div class="line">      </div><div class="line">    <span class="comment">// Подписываемся на событие нажатия кнопки с идентификатором &quot;id_hello&quot;.</span></div><div class="line">    (*_pEvents)[Event::Click][<span class="stringliteral">&quot;id_hello&quot;</span>]</div><div class="line">      .connect(::std::bind(&amp;DemoLayer2::DoHello, <span class="keyword">this</span>, _1));</div><div class="line">  }</div><div class="line">    </div><div class="line"><span class="keyword">private</span>:</div><div class="line">  <span class="keywordtype">void</span> DoHello(const ::covellite::core::params::Click &amp; _Value)</div><div class="line">  {</div><div class="line">    <span class="comment">// Функция будет вызвана при нажатии кнопки id_hello.</span></div><div class="line">      </div><div class="line">    <span class="comment">// Проверяем, что событие произошло для текущего окна (это позволит</span></div><div class="line">    <span class="comment">// делать элементы управления с одинаковыми идентификаторами в разных .rml </span></div><div class="line">    <span class="comment">// файлах; если все идентификаторы всех элементов во всех .rml файлах </span></div><div class="line">    <span class="comment">// гарантированно уникальны, проверку можно опустить).</span></div><div class="line">    <span class="keywordflow">if</span> (_Value.m_DocumentId != <a class="code" href="a32556.html#a301c71c12e55267b0cb37cea159fb211">GetId</a>()) <span class="keywordflow">return</span>;</div><div class="line">      </div><div class="line">    <span class="comment">// Выполняем действие, необходимое при нажатии на кнопку.</span></div><div class="line">    <a class="code" href="a32556.html#a2dc558bad1d0ae39587f5d543d5d2d7a">GetElement</a>(<span class="stringliteral">&quot;multiline_text&quot;</span>).SetText(u8<span class="stringliteral">&quot;Привет!&quot;</span>);</div><div class="line">  }</div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="keyword">explicit</span> DemoLayer2(Contex_t * _pContex) : </div><div class="line">    Layer_t(_pContex, PathToDataDirectory / <span class="stringliteral">&quot;demo2.rml&quot;</span>)</div><div class="line">  {</div><div class="line">  }</div><div class="line">};</div></div><!-- fragment --><p> Если необходим экран с заголовком, содержащим текст, заданный в заголовке .rml файла, создать класс наследник слоя, в конструкторе которого передать базовому классу идентификатор заголовка из его объявления в .rml файле.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code" href="a32660.html">ExampleWindow::DemoLayer1</a> final :</div><div class="line">  <span class="keyword">public</span> Layer_t</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="comment">// Интерфейс IWindow:</span></div><div class="line">  <span class="keywordtype">void</span> Subscribe(<span class="keyword">const</span> EventHandlerPtr_t &amp;)<span class="keyword"> override </span>{}</div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">  <span class="keyword">explicit</span> DemoLayer1(Contex_t * _pContex) :</div><div class="line">    Layer_t(_pContex, PathToDataDirectory / <span class="stringliteral">&quot;demo.rml&quot;</span>, <span class="stringliteral">&quot;title&quot;</span>)</div><div class="line">  {</div><div class="line">    ::alicorn::system::version::Info Info;</div><div class="line">    <span class="keyword">using namespace </span>::alicorn::extension::std;</div><div class="line">      </div><div class="line">    <a class="code" href="a32556.html#a2dc558bad1d0ae39587f5d543d5d2d7a">GetElement</a>(<span class="stringliteral">&quot;id_header&quot;</span>).SetText(</div><div class="line">      <span class="stringliteral">&quot;&lt;h1&gt;Covellite++ v&quot;</span> + string_cast&lt;::std::string, Locale::UTF8&gt;(</div><div class="line">        Info.GetValue(uT(<span class="stringliteral">&quot;FileVersionShort&quot;</span>))) + <span class="stringliteral">&quot;&lt;/h1&gt;&quot;</span>);</div><div class="line">  }</div><div class="line">};</div></div><!-- fragment --> <h2>Создание класса главного окна программы </h2>
<p>Класс главного окна программы отвечает за переключение пользовательских экранов и обработку пользовательского ввода.</p>
<p>Создать класс-наследник от класса <a class="el" href="a32300.html" title="Класс входит в проект Covellite.Core   Интерфейсный класс, предоставляющий классам окон доступ к собы...">covellite::core::IWindow</a> (а также <a class="el" href="a32340.html" title="Класс входит в проект Covellite.Core   Базовый класс для всех классов окон. ">covellite::core::Window</a>, если необходимо, например, завершать работу программы по нажатию кнопки), в конструкторе котрого установить набор строк для локализации приложения, загрузить используемые шрифты и добавить стартовый экран программы.</p>
<div class="fragment"><div class="line"><a class="code" href="a32676.html#a31e2fb8a104c0b48f51c6eaa3e318d1b">ExampleWindow::ExampleWindow</a>(<span class="keyword">const</span> WindowRocketPtr_t &amp; _pWindowRocket) :</div><div class="line">  m_pWindowRocket(_pWindowRocket)</div><div class="line">{</div><div class="line">  <span class="comment">// Набор строк локализации приложения.</span></div><div class="line">  m_pWindowRocket-&gt;Set(</div><div class="line">  {</div><div class="line">    { u8<span class="stringliteral">&quot;[HELLO]&quot;</span>, u8<span class="stringliteral">&quot;Привет&quot;</span> },</div><div class="line">  });</div><div class="line">    </div><div class="line">  <span class="comment">// Загрузка шрифтов, используемых в .rml</span></div><div class="line">  m_pWindowRocket-&gt;LoadFontFace(PathToDataDirectory / <span class="stringliteral">&quot;Times New Roman.ttf&quot;</span>);</div><div class="line">  m_pWindowRocket-&gt;LoadFontFace(PathToDataDirectory / <span class="stringliteral">&quot;Ubuntu.ttf&quot;</span>);</div><div class="line">    </div><div class="line">  <span class="comment">// Экран, который будет отображаться при старте программы.</span></div><div class="line">  m_pWindowRocket-&gt;AddLayer&lt;DemoLayer1&gt;();</div><div class="line">}</div></div><!-- fragment --><p> Подписаться на нужные события следует в функции Subscribe().</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="a32676.html#a144da68a59de1a2a05f4ff70acaec216">ExampleWindow::Subscribe</a>(<span class="keyword">const</span> EventHandlerPtr_t &amp; _pEvents) <span class="comment">/*override*/</span></div><div class="line">{</div><div class="line">  using ::covellite::core::Event;</div><div class="line">  using ::covellite::rocket::Window;</div><div class="line">    </div><div class="line">  <span class="comment">// Подписка на события выбора элементов управления.</span></div><div class="line">  (*_pEvents)[Event::Click][<span class="stringliteral">&quot;button1&quot;</span>]</div><div class="line">    .connect(::std::bind(&amp;Window::AddLayer&lt;DemoLayer2&gt;, m_pWindowRocket));</div><div class="line">  (*_pEvents)[Event::Click][<span class="stringliteral">&quot;button2&quot;</span>]</div><div class="line">    .connect(::std::bind(&amp;Window::AddLayer&lt;TableLayer&gt;, m_pWindowRocket));</div><div class="line">  (*_pEvents)[Event::Click][<span class="stringliteral">&quot;button3&quot;</span>]</div><div class="line">    .connect(::std::bind(&amp;Window::AddLayer&lt;ScrollLayer&gt;, m_pWindowRocket));</div><div class="line">  (*_pEvents)[Event::Click][<span class="stringliteral">&quot;exit&quot;</span>]</div><div class="line">    .connect(::std::bind(&amp;<a class="code" href="a32340.html#a6609414193afcde800799469e4d86bcb">ExampleWindow::Exit</a>, <span class="keyword">this</span>));</div><div class="line">}</div></div><!-- fragment --> <dl class="section note"><dt>Заметки</dt><dd>Цвет фона можно задавать как поле <b>background-color</b> для body в .rcss файле, но в этом случае для заполнения всего окна следует в стилях rml и body поставить <div class="fragment"><div class="line">rml</div><div class="line">{</div><div class="line">  top: 0px;</div><div class="line">  left: 0px;</div><div class="line">  width: 100%;</div><div class="line">  height: 100%;</div><div class="line">}</div><div class="line">  </div><div class="line">body</div><div class="line">{</div><div class="line">  top: 0px;</div><div class="line">  left: 0px;</div><div class="line">  width: 100%;</div><div class="line">  height: 100%;</div><div class="line">  background-color: blue;</div></div><!-- fragment --></dd>
<dd>
Идентификаторы элементов управления передаются в функцию-обработчик события Event::Click в нижнем регистре независимо от того, каким образом они были заданы в .rml файле.</dd></dl>
<p>В классе окна событие Event::Click будет вызываться для всех элементов управления всех активных пользовательских экранов, при этом здесь имеет смысл обрабатывать события, непосредственно связанные с работой окна (переход к другому слою или выход из программы).</p>
<p>Другие события, которые может обрабатывать окно, см. в описании класса <a class="el" href="a32276.html" title="Класс входит в проект Covellite.Core   Класс универсальных идентификаторов событий фреймворка...">covellite::core::Event</a>.</p>
<h2>Создание класса программы </h2>
<p>Класс программы содержит главный цикл обработки сообщений, отвечает за обработку системных сообщений и создание/разрушение главного окна программы.</p>
<dl class="section note"><dt>Заметки</dt><dd>При написании кода следует учитывать, что NativeActivity загружает главный модуль программы только один раз, при первом запуске программы, после чего при каждой последующей активации программы вызывает функцию точки входа. При этом объект класса программы будет создаваться каждый раз заново, но все статические объекты будут иметь состояния, унаследованные от предыдущей активации.</dd></dl>
<p>Создать класс-наследник от <a class="el" href="a32240.html" title="Класс входит в проект Covellite.Core   Базовый класс приложения для Android. ">covellite::core::Application</a>, конструктору которого передать способ отрисовки окна приложения (по событию или непрерывно), подписаться на необходимые события и добавить код обработки этих событий.</p>
<div class="fragment"><div class="line"><a class="code" href="a32656.html#ad68d51b325f5fc02a1b9d1e3a7005339">ExampleApp::ExampleApp</a>(<span class="keywordtype">void</span>) :</div><div class="line">  Application(EventBased{})</div><div class="line">{</div><div class="line">  using ::covellite::core::Event;</div><div class="line">    </div><div class="line">  (*m_pEvents)[Event::Create]</div><div class="line">    .connect(::std::bind(&amp;<a class="code" href="a32656.html#aaddf7b9a3ba89e61506f87d2ca3c149d">ExampleApp::DoInitWindow</a>, <span class="keyword">this</span>));</div><div class="line">  (*m_pEvents)[Event::Error]</div><div class="line">    .connect([](const ::covellite::core::params::Error &amp; _Description)</div><div class="line">      { LOGGER(Error) &lt;&lt; _Description.Description.c_str(); });</div><div class="line">  <span class="comment">// ...</span></div></div><!-- fragment --><p> Список получаемых событий см. в описании класса <a class="el" href="a32276.html" title="Класс входит в проект Covellite.Core   Класс универсальных идентификаторов событий фреймворка...">covellite::core::Event</a>.</p>
<dl class="section note"><dt>Заметки</dt><dd>Подписка на событие <b>Event::Create</b> обязательна, в обработчике следует создать набор окон программы; в качестве класса главного окна программы следует указать ранее созданный класс. <br />
 Подписка на собыие <b>Event::Destroy</b> не требуется, окно будет уничтожено автоматически.</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="a32656.html#aaddf7b9a3ba89e61506f87d2ca3c149d">ExampleApp::DoInitWindow</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line"><span class="preprocessor"># if BOOST_OS_WINDOWS</span></div><div class="line">  <span class="keyword">using</span> ApiImpl_t = <a class="code" href="a32196.html">::covellite::api::OpenGL</a>;</div><div class="line"><span class="preprocessor"># elif BOOST_OS_ANDROID</span></div><div class="line">  <span class="keyword">using</span> ApiImpl_t = <a class="code" href="a32200.html">::covellite::api::OpenGLES</a>;</div><div class="line"><span class="preprocessor"># endif</span></div><div class="line">    </div><div class="line">  LOGGER(Info) &lt;&lt; <span class="stringliteral">&quot;Create main window.&quot;</span>;</div><div class="line">    </div><div class="line">  <span class="comment">// Создание необходимых приложению объектов окон.</span></div><div class="line">  MakeWindow&lt;ExampleWindow&gt;(</div><div class="line">    MakeWindow&lt;::covellite::rocket::Window&gt;(</div><div class="line">      MakeWindow&lt;::covellite::api::Window&lt;ApiImpl_t&gt;&gt;(</div><div class="line">        MakeWindow&lt;::covellite::os::Window&gt;())));</div><div class="line">}</div></div><!-- fragment --><p> Для создания точки входа программы использовать макрос <b>APPLICATION_ENTRY_POINT</b>, в качестве параметра которого указать имя созданного класса программы.</p>
<div class="fragment"><div class="line"><a class="code" href="a32069.html#gad03011d9bf6bfcedf9031a4d7cddebfd">APPLICATION_ENTRY_POINT</a>(<a class="code" href="a32656.html">ExampleApp</a>);</div></div><!-- fragment --></div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Главная страница документации</a></li><li class="navelem"><a class="el" href="a32779.html">Covellite++</a></li>
    <li class="footer">Документация по Covellite++. Последние изменения: Пт 3 Ноя 2017 11:37:01. Создано системой
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
